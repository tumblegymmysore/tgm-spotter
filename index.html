<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotter | TGM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="toast"><i class="fas fa-check-circle mr-2"></i> System Ready</div>

    <nav class="bg-white/95 backdrop-blur-md border-b border-slate-200 fixed w-full z-50 transition-all">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center cursor-pointer" onclick="window.location.reload()">
                <img src="logo.png" alt="TGM" class="h-10 w-auto object-contain">
                <span class="font-bold text-xl text-blue-900 ml-2 hidden sm:block">Spotter</span>
            </div>
            <div id="nav-public">
                <button onclick="document.getElementById('login-modal').classList.remove('hidden')" class="px-4 py-2 rounded-lg text-sm font-bold text-blue-600 border border-blue-200 hover:bg-blue-50">Login</button>
            </div>
            <div id="nav-private" class="hidden flex items-center gap-3">
                <select id="role-switcher" onchange="loadView(this.value)" class="hidden text-xs font-bold border rounded p-1 bg-slate-50 text-slate-600 outline-none"></select>
                <span id="user-role-badge" class="text-xs font-bold uppercase bg-slate-100 text-slate-500 px-2 py-1 rounded">User</span>
                <button onclick="handleLogout()" class="text-xs font-bold text-red-500">Logout</button>
            </div>
        </div>
    </nav>

    <div id="landing" class="pt-16 fade-in">
        <header class="hero-gradient text-white text-center py-24 px-4 rounded-b-[3rem] shadow-xl relative overflow-hidden">
            <div class="relative z-10 max-w-3xl mx-auto">
                <span class="bg-yellow-400 text-blue-900 text-xs font-extrabold px-3 py-1 rounded-full uppercase tracking-wide mb-4 inline-block shadow-sm">Admissions Open</span>
                <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">Where Kids Learn to <br/><span class="text-yellow-300">Fly & Tumble!</span></h1>
                <p class="text-blue-100 text-lg md:text-xl mb-8 font-medium">Professional gymnastics training for ages 3-14 in Mysore.</p>
                <button onclick="scrollToSection('intake-form')" class="bg-rose-500 text-white px-8 py-4 rounded-full font-bold shadow-lg hover:bg-rose-600 transform hover:scale-105 transition">Book Free Trial</button>
            </div>
        </header>

        <section class="max-w-4xl mx-auto -mt-10 px-4 relative z-20">
            <div class="bg-white p-6 rounded-2xl card-shadow grid grid-cols-3 gap-4 text-center divide-x divide-slate-100">
                <div><div class="text-3xl font-bold text-blue-600">300+</div><div class="text-xs text-slate-500 font-bold uppercase mt-1">Happy Kids</div></div>
                <div><div class="text-3xl font-bold text-yellow-500">12+</div><div class="text-xs text-slate-500 font-bold uppercase mt-1">Expert Trainers</div></div>
                <div><div class="text-3xl font-bold text-rose-500">4.9</div><div class="text-xs text-slate-500 font-bold uppercase mt-1">Rating</div></div>
            </div>
        </section>

        <section id="intake-form" class="max-w-4xl mx-auto mt-24 mb-24 px-4">
             <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-8">
                <div class="text-center mb-8"><h2 class="text-2xl font-bold text-slate-800">Book a Free Trial</h2><p class="text-slate-500 text-sm">Please fill out the details below.</p></div>
                <form onsubmit="handleIntakeSubmit(event)" class="space-y-8">
                    <div class="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                        <h3 class="text-blue-900 font-bold mb-4 flex items-center"><i class="fas fa-child mr-2"></i> Child's Details</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Child Name *</label><input type="text" id="k_name" class="input-field" required></div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">DOB *</label><input type="date" id="dob" class="input-field" onchange="calculateAgeDisplay()" required><p id="age-display" class="hidden text-xs font-bold text-blue-600 mt-2">Age: <span id="age-value"></span> Years</p></div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Gender *</label><select id="gender" class="input-field bg-white" required><option value="" disabled selected>Select</option><option>Male</option><option>Female</option></select></div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Goal *</label><select id="intent" class="input-field bg-white" onchange="checkOther(this, 'intent_other')" required><option value="" disabled selected>Select</option><option>Fun & Fitness</option><option>Professional</option><option value="Other">Other</option></select><input type="text" id="intent_other" class="input-field mt-2 hidden" placeholder="Specify..."></div>
                        </div>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                        <h3 class="text-slate-800 font-bold mb-4 flex items-center"><i class="fas fa-user-shield mr-2"></i> Parent Details</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Parent Name *</label><input type="text" id="p_name" class="input-field" required></div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Phone (WhatsApp) *</label><input type="tel" id="phone" class="input-field" required></div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Email *</label><input type="email" id="email" class="input-field" required></div>
                            <div><label class="text-xs font-bold text-slate-500 uppercase">Emergency Contact *</label><input type="tel" id="alt_phone" class="input-field" placeholder="Emergency Phone" required></div>
                            <div class="md:col-span-2"><label class="text-xs font-bold text-slate-500 uppercase">Address *</label><input type="text" id="address" class="input-field" required></div>
                        </div>
                    </div>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="md:col-span-2"><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Medical Info *</label><textarea id="medical" class="input-field" rows="2" placeholder="List allergies or type 'None'..." required></textarea></div>
                        <div class="md:col-span-2"><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Source *</label><select id="source" class="input-field bg-white" onchange="checkOther(this, 'source_other')" required><option value="" disabled selected>Select</option><option>Google Search</option><option>Social Media</option><option>Referral</option><option value="Other">Other</option></select><input type="text" id="source_other" class="input-field mt-2 hidden" placeholder="Specify..."></div>
                    </div>
                    <div class="bg-yellow-50 p-6 rounded-2xl border border-yellow-100">
                        <h3 class="text-yellow-800 font-bold mb-2"><i class="fas fa-file-contract mr-2"></i> Waiver & Consent</h3>
                        <div class="terms-box">
                            <p><strong>1. Parent/Guardian Confirmation:</strong> By checking this box, I confirm that I am the legal parent/guardian of the child listed above and authorize their participation in The Tumble Gym's program. I hereby declare that all the information provided in this registration form is true and accurate to the best of my knowledge.</p><br>
                            <p><strong>2. Risk Acknowledgement:</strong> I acknowledge and understand that participation in physical exercises and fitness activities carries inherent risks. I voluntarily assume all such risks associated with my child's participation in The Tumble Gym's activities.</p><br>
                            <p><strong>3. Liability Waiver:</strong> I hereby release and hold harmless The Tumble Gym Mysore, its owners, staff, and instructors from any liability for any injury or accident that may occur during my child's participation in the gymnastics program, including but not limited to any injuries resulting from the use of equipment, facilities, or participation in any activities conducted by The Tumble Gym.</p><br>
                            <p><strong>4. Media Consent:</strong> I understand and agree that my child may be photographed and/or videographed during classes and events. These images and videos may be used for promotional purposes, including social media, brochures, and other marketing materials.</p><br>
                            <p><strong>5. Policy Agreement:</strong> I acknowledge that the membership and any associated packages are non-transferable and non-refundable. I have read, understood, and agree to abide by the terms and conditions outlined by The Tumble Gym.</p>
                        </div>
                        <div class="checkbox-wrapper"><input type="checkbox" id="terms_check" required class="mt-1"><label class="checkbox-text font-bold">I Agree to the Terms & Conditions above. *</label></div>
                        <div class="checkbox-wrapper"><input type="checkbox" id="marketing_check" required class="mt-1"><label class="checkbox-text">By checking this box, I authorize The Tumble Gym to contact me via phone/WhatsApp or email for feedback regarding my child's participation and to provide information about future programs, events, and special offers. *</label></div>
                    </div>
                    <button type="submit" id="btn-submit" class="w-full bg-rose-500 text-white font-bold py-4 rounded-xl hover:bg-rose-600 transition shadow-lg text-lg">Request Free Slot</button>
                </form>
             </div>
        </section>
    </div>

    <div id="parent-portal" class="hide pt-24 px-4 fade-in max-w-md mx-auto">
        <div class="text-center mb-8"><h1 class="text-3xl font-bold text-slate-800">My Child</h1></div>
        <div id="parent-content" class="space-y-4"></div>
    </div>

    <div id="trainer" class="hide pt-24 px-4 fade-in max-w-lg mx-auto pb-20">
        <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold text-slate-800">Trial Manager</h1></div>
        <div class="space-y-3" id="trial-list"></div>
    </div>

    <div id="admin" class="hide pt-24 px-4 fade-in max-w-6xl mx-auto pb-20">
        <div class="flex justify-between items-end mb-8"><h1 class="text-3xl font-bold text-slate-800">Admin Dashboard</h1></div>
        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="stat-card"><div class="stat-value" id="stat-total">0</div><div class="stat-label">Total Leads</div></div>
            <div class="stat-card"><div class="stat-value text-yellow-600" id="stat-reqs">0</div><div class="stat-label">Registration Reqs</div></div>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow"><div class="overflow-x-auto"><table class="w-full text-left text-sm"><thead class="bg-slate-50 font-bold"><tr><th class="p-3">Child</th><th class="p-3">Status</th><th class="p-3">Action</th></tr></thead><tbody id="admin-list"></tbody></table></div></div>
    </div>

    <div id="login-modal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <h3 class="text-xl font-bold text-slate-800 mb-2">Welcome Back</h3>
            <p class="text-xs text-slate-500 mb-4">Login with Email & Password (Phone Number)<br>OR get a login link via email.</p>
            <input type="email" id="login-email" class="input-field mb-3" placeholder="Email Address">
            <input type="password" id="login-password" class="input-field mb-4" placeholder="Password (Default: Phone #)">
            <button onclick="handleLogin()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 mb-3">Login with Password</button>
            <div class="relative flex py-2 items-center"><div class="flex-grow border-t border-slate-200"></div><span class="flex-shrink-0 mx-4 text-gray-400 text-xs">OR</span><div class="flex-grow border-t border-slate-200"></div></div>
            <button onclick="handleMagicLink()" class="w-full bg-slate-100 text-slate-700 font-bold py-3 rounded-lg hover:bg-slate-200 border border-slate-200"><i class="fas fa-magic mr-2"></i> Email me a Login Link</button>
            <p onclick="document.getElementById('login-modal').classList.add('hidden')" class="text-slate-400 text-xs mt-4 cursor-pointer hover:underline">Cancel</p>
        </div>
    </div>

    <div id="trial-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-lg font-bold mb-2">Assessment</h3>
            <p class="text-sm mb-4" id="modal-child-name"></p>
            <label class="text-xs font-bold uppercase block mb-1">Feedback</label>
            <textarea id="trainer-feedback" class="input-field mb-3" rows="3" placeholder="Enter assessment details..."></textarea>
            <label class="text-xs font-bold uppercase block mb-1">Recommended Batch</label>
            <select id="trainer-batch" class="input-field mb-6"><option value="3-5 Yrs">3-5 Yrs</option><option value="5-8 Yrs">5-8 Yrs</option><option value="8+ Yrs">8+ Yrs</option><option value="Adult">Adult (18+)</option></select>
            <button id="btn-save-trial" onclick="submitTrialResult()" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700">Save & Mark Complete</button>
            <button id="btn-edit-trial" onclick="enableTrialEdit()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hidden">Enable Edit</button>
            <button onclick="document.getElementById('trial-modal').classList.add('hidden')" class="w-full text-slate-400 mt-2 text-xs">Close</button>
        </div>
    </div>

<div id="reg-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-xl font-bold text-slate-800">Registration</h3>
                <button onclick="document.getElementById('reg-modal').classList.add('hidden')" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times"></i></button>
            </div>
            
            <input type="hidden" id="is-renewal">

            <div class="review-box">
                <div class="review-header" onclick="toggleReview()">
                    <span><i class="fas fa-user-edit mr-2"></i> Review Personal Details</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div id="review-body" class="review-body">
                    <div class="grid gap-3">
                        <div><label>Child Name</label><input type="text" id="edit-name" class="input-field h-8 text-sm"></div>
                        <div><label>Phone</label><input type="tel" id="edit-phone" class="input-field h-8 text-sm"></div>
                        <div><label>Email</label><input type="email" id="edit-email" class="input-field h-8 text-sm bg-gray-100 text-gray-500" readonly></div>
                    </div>
                </div>
            </div>

            <p class="text-xs font-bold text-slate-500 uppercase mb-2">Select Plan for <span id="reg-child-name" class="text-blue-600"></span></p>
            
            <div id="reg-slots-info" class="slot-info mb-4"></div>

            <select id="reg-package" class="input-field mb-4" onchange="handlePackageChange()">
                <option value="" disabled selected>Select a Package</option>
                <optgroup label="Regular Gymnastics">
                    <option value="2 Days/Week - 1 Month|3,500">2 Days/Week - 1 Month (₹3,500)</option>
                    <option value="2 Days/Week - 3 Months|9,000">2 Days/Week - 3 Months (₹9,000)</option>
                    <option value="2 Days/Week - 6 Months|16,000">2 Days/Week - 6 Months (₹16,000)</option>
                    <option value="2 Days/Week - 12 Months|25,000">2 Days/Week - 12 Months (₹25,000)</option>
                    <option value="Unlimited - 1 Month|5,500">Unlimited - 1 Month (₹5,500)</option>
                    <option value="Unlimited - 3 Months|15,000">Unlimited - 3 Months (₹15,000)</option>
                    <option value="Unlimited - 6 Months|25,000">Unlimited - 6 Months (₹25,000)</option>
                    <option value="Unlimited - 12 Months|35,000">Unlimited - 12 Months (₹35,000)</option>
                </optgroup>
                <optgroup label="Professional">
                    <option value="Special">Special / Professional Training</option>
                </optgroup>
            </select>

            <div id="training-level-group" class="hidden mb-4 pl-3 border-l-4 border-blue-500 bg-blue-50 py-2 rounded-r">
                <label class="text-blue-700">Select Training Level</label>
                <select id="reg-level" class="input-field" onchange="calculateTotal()">
                    <option value="Beginner">Beginner (₹700/class)</option>
                    <option value="Intermediate">Intermediate (₹850/class)</option>
                    <option value="Advanced">Advanced (₹1,000/class)</option>
                </select>
            </div>

            <label>Preferred Start Date</label>
            <input type="date" id="reg-date" class="input-field mb-4">

            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-4">
                <div id="reg-fee-row" class="flex justify-between mb-2 text-slate-500 text-sm">
                    <span>Registration Fee (One Time)</span>
                    <span>₹<span id="reg-fee-display">2000</span></span>
                </div>
                <div class="flex justify-between font-extrabold text-lg text-slate-800 border-t border-slate-200 pt-2">
                    <span>Total To Pay</span>
                    <span>₹<span id="total-price">0</span></span>
                </div>
            </div>

            <div class="qr-grid">
                <div class="qr-box">
                    <div class="qr-label">Scan to Pay (Option 1)</div>
                    <img src="qr1.png" class="h-24 w-24 mx-auto object-contain bg-white">
                </div>
                <div class="qr-box">
                    <div class="qr-label">Scan to Pay (Option 2)</div>
                    <img src="qr2.png" class="h-24 w-24 mx-auto object-contain bg-white">
                </div>
            </div>

            <div class="mb-6">
                <label>Upload Payment Screenshot *</label>
                <input type="file" id="payment-proof" accept="image/*" class="w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            </div>
            
            <button id="btn-submit-reg" onclick="submitRegistration()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 shadow-lg transition">Submit Request</button>
        </div>
    </div>

    <div id="admin-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-lg font-bold mb-4">Student Management</h3>
            <div id="admin-modal-body"></div>
            <button onclick="document.getElementById('admin-modal').classList.add('hidden')" class="w-full text-slate-400 mt-4 text-xs">Close</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
