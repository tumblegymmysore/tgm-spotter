<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotter | TGM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="toast"><i class="fas fa-check-circle mr-2"></i> System Ready</div>

    <div id="auth-container">
        <div class="auth-box">
            <img src="logo.png" alt="TGM" class="h-16 mx-auto mb-4 object-contain">
            <h2 class="text-2xl font-bold text-slate-800 mb-6">Welcome Back</h2>
            
            <div class="flex mb-6">
                <div id="tab-login" class="auth-tab active" onclick="switchAuth('login')">Login</div>
                <div id="tab-signup" class="auth-tab" onclick="switchAuth('signup')">Parent Signup</div>
            </div>

            <form id="login-form" onsubmit="handleLogin(event)" class="space-y-4">
                <input type="email" id="login-email" class="input-field" placeholder="Email Address" required>
                <input type="password" id="login-password" class="input-field" placeholder="Password" required>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 shadow-lg">Login</button>
                <p onclick="resetPassword()" class="text-xs text-blue-500 cursor-pointer hover:underline mt-2">Forgot Password?</p>
            </form>

            <form id="signup-form" onsubmit="handleSignup(event)" class="space-y-4 hidden">
                <input type="email" id="signup-email" class="input-field" placeholder="Email Address" required>
                <input type="password" id="signup-password" class="input-field" placeholder="Create Password" required>
                <input type="text" id="signup-phone" class="input-field" placeholder="Phone Number" required>
                <button type="submit" class="w-full bg-rose-600 text-white font-bold py-3 rounded-xl hover:bg-rose-700 shadow-lg">Create Parent Account</button>
            </form>
            
            <div id="auth-message" class="text-xs text-red-500 font-bold mt-4"></div>
        </div>
    </div>

    <div id="app-content" class="hidden">
        
        <nav class="bg-white/95 backdrop-blur-md border-b border-slate-200 fixed w-full z-50 transition-all">
            <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
                <div class="flex items-center">
                    <img src="logo.png" alt="TGM" class="h-10 w-auto object-contain">
                    <span class="font-bold text-xl text-blue-900 ml-2 hidden sm:block">Spotter</span>
                </div>
                <div class="flex items-center gap-3">
                    <span id="user-role-badge" class="text-xs font-bold uppercase bg-slate-100 text-slate-500 px-2 py-1 rounded">Guest</span>
                    <button onclick="handleLogout()" class="text-xs font-bold text-red-500 border border-red-200 px-3 py-1 rounded hover:bg-red-50">Logout</button>
                </div>
            </div>
        </nav>

        <div id="landing" class="pt-16 fade-in">
            <header class="hero-gradient text-white text-center py-12 px-4 rounded-b-[3rem]">
                <h1 class="text-3xl font-bold mb-2">New Student Intake</h1>
                <p class="text-blue-100">Submit details for Trial or Enrollment</p>
            </header>
            <section class="max-w-4xl mx-auto mt-8 mb-24 px-4">
                <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-8">
                    <form onsubmit="handleIntakeSubmit(event)" class="space-y-6">
                        <div class="flex justify-center mb-6">
                            <div class="bg-slate-100 p-1 rounded-xl flex">
                                <button type="button" id="btn-trial" class="px-6 py-2 rounded-lg font-bold text-sm bg-white shadow text-blue-600" onclick="toggleTrial(true)">Trial Class</button>
                                <button type="button" id="btn-direct" class="px-6 py-2 rounded-lg font-bold text-sm text-slate-500" onclick="toggleTrial(false)">Direct Admission</button>
                            </div>
                            <input type="hidden" id="is_trial" value="true">
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <input type="text" id="k_name" class="input-field" placeholder="Child Name *" required>
                            <input type="text" id="p_name" class="input-field" placeholder="Parent Name *" required>
                            <input type="tel" id="phone" class="input-field" placeholder="Phone *" required>
                            <input type="date" id="dob" class="input-field" onchange="calculateAgeDisplay()" required>
                            <select id="gender" class="input-field bg-white" required><option value="">Gender</option><option>Male</option><option>Female</option></select>
                            <select id="intent" class="input-field bg-white" required><option value="">Goal</option><option>Fun</option><option>Pro</option></select>
                        </div>
                        <p id="age-display" class="text-xs font-bold text-blue-600 hidden">Age: <span id="age-value"></span></p>
                        <button type="submit" id="btn-submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700">Submit Application</button>
                    </form>
                </div>
            </section>
        </div>

        <div id="parent-portal" class="hide pt-24 px-4 fade-in max-w-md mx-auto">
            <div class="text-center mb-8"><h1 class="text-2xl font-bold">My Child</h1></div>
            <div id="parent-content" class="bg-white p-6 rounded-2xl shadow-lg border-l-4 border-yellow-500">
                <p class="text-center text-slate-500">Loading your data...</p>
            </div>
        </div>

        <div id="trainer" class="hide pt-24 px-4 fade-in max-w-lg mx-auto">
            <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Trial Manager</h1><button onclick="loadTrainerDashboard()" class="text-xs bg-slate-100 px-2 py-1 rounded">Refresh</button></div>
            <div id="trial-list" class="space-y-3"></div>
        </div>

        <div id="admin" class="hide pt-24 px-4 fade-in max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold">Admin Overview</h1><button onclick="fetchLeads()" class="text-xs bg-slate-100 px-2 py-1 rounded">Refresh</button></div>
            <div class="bg-white p-6 rounded-2xl shadow overflow-x-auto">
                <table class="w-full text-left text-sm"><thead class="bg-slate-50 font-bold"><tr><th class="p-3">Child</th><th class="p-3">Status</th><th class="p-3">Action</th></tr></thead><tbody id="leads-list"></tbody></table>
            </div>
        </div>

    </div>

    <div id="trial-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="font-bold mb-2">Assessment</h3>
            <p class="text-sm mb-4" id="modal-child-name"></p>
            <textarea id="trainer-feedback" class="input-field mb-2" placeholder="Feedback"></textarea>
            <select id="trainer-batch" class="input-field mb-4"><option>3-5 Yrs</option><option>5-8 Yrs</option><option>8+ Yrs</option></select>
            <button onclick="submitTrialResult()" class="w-full bg-green-600 text-white font-bold py-2 rounded">Save</button>
            <button onclick="document.getElementById('trial-modal').classList.add('hidden')" class="w-full text-slate-400 text-xs mt-2">Close</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
