<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotter | TGM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="toast"><i class="fas fa-check-circle mr-2"></i> System Ready</div>

    <nav class="bg-white/95 backdrop-blur-md border-b border-slate-200 fixed w-full z-50 transition-all">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center cursor-pointer" onclick="window.location.reload()">
                <img src="logo.png" alt="TGM" class="h-10 w-auto object-contain">
                <span class="font-bold text-xl text-blue-900 ml-2 hidden sm:block">Spotter</span>
            </div>
            <div id="nav-public">
                <button onclick="document.getElementById('login-modal').classList.remove('hidden')" class="px-5 py-2 rounded-lg text-sm font-bold text-blue-600 border border-blue-200 hover:bg-blue-50 transition">
                    <i class="fas fa-sign-in-alt mr-2"></i> Login
                </button>
            </div>
            <div id="nav-private" class="hidden flex items-center gap-3">
                <select id="role-switcher" onchange="window.loadView(this.value)" class="hidden text-xs font-bold border rounded p-1 bg-slate-50 text-slate-600 outline-none"></select>
                <span id="user-role-badge" class="text-xs font-bold uppercase bg-slate-100 text-slate-500 px-3 py-1 rounded-full">User</span>
                <button onclick="window.handleLogout()" class="text-xs font-bold text-red-500 hover:text-red-700">Logout</button>
            </div>
        </div>
    </nav>

    <div id="landing" class="pt-16 fade-in">
        <header class="hero-gradient text-white text-center py-20 px-4 rounded-b-[3rem] relative shadow-lg">
            <div class="max-w-3xl mx-auto">
                <span class="bg-yellow-400 text-blue-900 text-xs font-extrabold px-4 py-2 rounded-full uppercase tracking-wide mb-4 inline-block shadow-lg animate-bounce">üéâ New Sessions Starting Soon!</span>
                <h1 class="text-4xl md:text-5xl font-extrabold mb-4 leading-tight">Where Little Champions <br/><span class="text-yellow-300">Flip, Fly & Shine! ‚ú®</span></h1>
                <p class="text-blue-100 text-lg mb-8 font-semibold">Fun-filled gymnastics adventures for ages 3+ in Mysore! Build strength, confidence & amazing skills! üèÜ</p>
                <button onclick="window.scrollToSection('intake-form')" class="bg-gradient-to-r from-pink-500 to-rose-600 text-white px-10 py-4 rounded-full font-bold shadow-xl hover:shadow-2xl transform hover:scale-110 transition-all text-lg">
                    üéØ Start Your Gymnastics Journey - Free Trial!
                </button>
            </div>
        </header>

        <section class="max-w-4xl mx-auto -mt-10 px-4 relative z-20">
            <div class="bg-white p-6 rounded-2xl card-shadow grid grid-cols-3 gap-4 text-center divide-x divide-slate-100">
                <div><div class="text-3xl font-bold text-blue-600">300+</div><div class="text-xs text-slate-600 font-bold uppercase mt-1">üåü Happy Gymnasts</div></div>
                <div><div class="text-3xl font-bold text-yellow-500">12+</div><div class="text-xs text-slate-600 font-bold uppercase mt-1">üèÖ Expert Coaches</div></div>
                <div><div class="text-3xl font-bold text-rose-500">4.9</div><div class="text-xs text-slate-600 font-bold uppercase mt-1">‚≠ê Star Rating</div></div>
            </div>
        </section>

        <section id="intake-form" class="max-w-4xl mx-auto mt-20 mb-24 px-4">
             <div class="bg-white rounded-3xl shadow-xl border border-slate-100 p-8">
                <div class="text-center mb-10">
                    <h2 class="text-4xl font-extrabold mb-2 section-header">Join the Tumble Gym Family! üé™</h2>
                    <p class="text-slate-600 text-sm font-semibold">Let's get your little star ready to shine! ‚ú®</p>
                </div>
                <form onsubmit="window.handleIntakeSubmit(event)" class="space-y-8">
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-2xl border-2 border-blue-200 shadow-md">
                        <h3 class="text-blue-900 font-bold mb-4 flex items-center text-lg">
                            <span class="text-2xl mr-2">üë∂</span> Tell Us About Your Little Gymnast!
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div><label>Child Name *</label><input type="text" id="k_name" class="input-field" required></div>
                            <div class="relative">
                                <label>Date of Birth *</label>
                                <input type="date" id="dob" class="input-field w-full max-w-full" onchange="window.calculateAgeDisplay(); window.checkAgeEligibility(); window.generateTrialSlots()" required style="max-width: 100%; box-sizing: border-box;">
                                <p id="age-display" class="text-xs font-bold text-blue-600 mt-1 hidden">Age: <span id="age-value"></span> Years</p>
                                <!-- Age Eligibility Message -->
                                <div id="age-ineligible-message" class="hidden mt-4 p-6 bg-gradient-to-br from-orange-50 via-amber-50 to-yellow-50 rounded-xl border-2 border-orange-300 shadow-lg">
                                    <div class="text-center">
                                        <div class="text-5xl mb-4 animate-bounce">üë∂‚ú®ü§∏</div>
                                        <h3 class="text-xl font-extrabold text-orange-900 mb-3 bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">
                                            Too Young to Tumble Just Yet!
                                        </h3>
                                        <p class="text-sm text-orange-800 mb-4 leading-relaxed font-semibold">
                                            Your little superstar needs to be at least <strong class="text-orange-900">2.5 years old</strong> to join our gymnastics adventure! üåü
                                        </p>
                                        <p class="text-xs text-orange-700 mb-5 leading-relaxed">
                                            Don't worry! Time flies faster than a cartwheel! üé™ We'd love to welcome them when they're ready to flip, fly, and shine! Until then, feel free to reach out if you have any questions - we're here to help! üí´
                                        </p>
                                        <a href="https://wa.me/918618684685" target="_blank" class="inline-flex items-center justify-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-8 py-4 rounded-xl text-sm font-bold hover:from-green-600 hover:to-emerald-700 transition-all shadow-lg transform hover:scale-105 hover:shadow-xl">
                                            <i class="fab fa-whatsapp text-lg"></i> 
                                            <span>Chat with Us on WhatsApp!</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div><label>Gender *</label><select id="gender" class="input-field" required><option value="">Select</option><option>Male</option><option>Female</option></select></div>
                            <div><label>Intent / Goal *</label><select id="intent" class="input-field" onchange="window.checkOther(this, 'intent_other')" required><option value="">Select</option><option>Fun & Fitness</option><option>Professional Training</option><option>Weight Loss</option><option value="Other">Other</option></select><input type="text" id="intent_other" class="input-field mt-2 hidden" placeholder="Specify..."></div>
                        </div>
                    </div>

                    <div id="trial-section" class="bg-gradient-to-br from-purple-50 via-pink-50 to-indigo-50 p-6 rounded-2xl border-2 border-purple-200 relative overflow-hidden shadow-md">
                        <div class="absolute -right-6 -top-6 w-32 h-32 bg-gradient-to-br from-purple-200 to-pink-200 rounded-full opacity-30 pointer-events-none animate-pulse"></div>
                        <h3 class="text-purple-900 font-bold mb-4 flex items-center text-lg z-10 relative">
                            <span class="text-2xl mr-2">üìÖ</span> Pick Your First Adventure Time!
                        </h3>
                        
                        <div class="mb-4">
                             <label class="block text-xs font-bold text-indigo-500 uppercase mb-2">Preferred Time</label>
                             <div class="flex bg-white p-1 rounded-lg border border-indigo-100 w-fit">
                                <button type="button" onclick="window.setTrialPreference('Evening')" id="btn-pref-evening" class="px-4 py-2 rounded-md text-sm font-bold bg-indigo-600 text-white shadow-sm transition-all">Evening / Weekend</button>
                                <button type="button" onclick="window.setTrialPreference('Morning')" id="btn-pref-morning" class="px-4 py-2 rounded-md text-sm font-bold text-slate-500 hover:bg-indigo-50 transition-all">Morning (6:15 AM)</button>
                             </div>
                             <input type="hidden" id="trial-pref-val" value="Evening">
                        </div>

                        <div id="slots-container" class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <p class="text-sm text-slate-400 col-span-3 italic">Please enter Date of Birth to view available slots.</p>
                        </div>
                        <input type="hidden" id="selected-trial-slot" required>
                        <p id="slot-error" class="text-xs font-bold text-red-500 mt-2 hidden">Please select a trial slot.</p>
                        
                        <div id="adult-message" class="hidden bg-white p-4 rounded-xl border border-indigo-100 text-center">
                            <p class="text-sm font-bold text-indigo-900 mb-2">Adult Personal Training</p>
                            <p class="text-xs text-slate-600 mb-3">Evening sessions for adults are by appointment only.</p>
                            <a href="https://wa.me/918618684685" target="_blank" class="inline-block bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-green-600">
                                <i class="fab fa-whatsapp mr-2"></i> Contact on WhatsApp
                            </a>
                        </div>
                    </div>

                        <div class="bg-gradient-to-br from-slate-50 to-blue-50 p-6 rounded-2xl border-2 border-slate-200 shadow-md">
                        <h3 class="text-slate-800 font-bold mb-4 flex items-center text-lg">
                            <span class="text-2xl mr-2">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> Parent/Guardian Information
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div><label>Parent Name *</label><input type="text" id="p_name" class="input-field" required></div>
                            <div><label>Mobile (WhatsApp) *</label><input type="tel" id="phone" class="input-field" required></div>
                            <div><label>Email *</label><input type="email" id="email" class="input-field" required></div>
                            <div><label>Emergency Contact (Alternate Number) *</label><input type="tel" id="alt_phone" class="input-field" required></div>
                            <div class="md:col-span-2"><label>Address *</label><input type="text" id="address" class="input-field" required></div>
                        </div>
                    </div>
                    
                    <!-- Medical Info Section (hidden when age < 2.5) -->
                    <div id="medical-section" class="grid md:grid-cols-2 gap-6">
                        <div class="md:col-span-2"><label>Medical Info *</label><textarea id="medical" class="input-field" rows="2" placeholder="List any medical conditions, injuries, allergies or 'None'" required></textarea></div>
                        <div class="md:col-span-2"><label>How did you hear about us? *</label><select id="source" class="input-field" onchange="window.checkOther(this, 'source_other')" required><option value="">Select</option><option>Google Search / Maps</option><option>Instagram / Facebook</option><option>Friend / Referral</option><option value="Other">Other</option></select><input type="text" id="source_other" class="input-field mt-2 hidden" placeholder="Specify..."></div>
                    </div>
                    <div class="bg-gradient-to-br from-yellow-50 to-amber-50 p-6 rounded-2xl border-2 border-yellow-200 shadow-md">
                        <h3 class="text-yellow-800 font-bold mb-2 text-lg flex items-center">
                            <span class="text-2xl mr-2">üìã</span> Important Information & Consent
                        </h3>
                        <div class="terms-box">
                            <p><strong>1. Parent/Guardian Confirmation:</strong> By checking this box, I confirm that I am the legal parent/guardian of the child listed above and authorize their participation in The Tumble Gym's program.</p>
                            <p><strong>2. Risk Acknowledgement:</strong> I acknowledge and understand that participation in physical exercises and fitness activities carries inherent risks. I voluntarily assume all such risks associated with my child's participation.</p>
                            <p><strong>3. Liability Waiver:</strong> I hereby release and hold harmless The Tumble Gym Mysore, its owners, staff, and instructors from any liability for any injury or accident that may occur during participation.</p>
                            <p><strong>4. Media Consent:</strong> I understand and agree that my child may be photographed and/or videographed during classes and events for promotional purposes.</p>
                            <p><strong>5. Policy Agreement:</strong> I acknowledge that membership fees are non-transferable and non-refundable. I agree to abide by the terms and conditions outlined by The Tumble Gym.</p>
                        </div>
                        <div class="checkbox-wrapper"><input type="checkbox" id="terms_check" required><label>I Agree to Terms *</label></div>
                        <div class="checkbox-wrapper"><input type="checkbox" id="marketing_check" required><label>Allow Communication *</label></div>
                    </div>
                    <button type="submit" id="btn-submit" class="w-full bg-gradient-to-r from-pink-500 via-rose-500 to-red-500 text-white font-bold py-5 rounded-xl hover:shadow-2xl transform hover:scale-105 transition-all text-lg shadow-xl">
                        üöÄ Submit & Start Your Gymnastics Journey!
                    </button>
                </form>
             </div>
        </section>
    </div>

    <div id="parent-portal" class="hide pt-24 px-4 fade-in max-w-2xl mx-auto mb-20">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold mb-2 section-header">My Gymnastics Hub üè†</h1>
            <p class="text-slate-600 text-sm">Welcome back! Here's everything about your little star! ‚≠ê</p>
        </div>
        
        <!-- Primary Content: Kids Information (Always at Top) -->
        <div id="parent-content" class="space-y-6 mb-6"></div>
        
        <!-- Collapsible Information Section (Accessible but Secondary) -->
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border-2 border-blue-200 shadow-md overflow-hidden">
            <button onclick="window.toggleParentInfo()" class="w-full p-4 flex items-center justify-between hover:bg-blue-100 transition" id="parent-info-toggle">
                <h2 class="text-lg font-bold text-blue-900 flex items-center">
                    <span class="text-2xl mr-2">üìã</span> Quick Reference Guide
                </h2>
                <i class="fas fa-chevron-down text-blue-600 transition-transform" id="parent-info-icon"></i>
            </button>
            <div id="parent-info-content" class="hidden px-6 pb-6 space-y-4">
                <div class="bg-white rounded-xl p-4 border border-blue-100">
                    <h3 class="font-bold text-blue-800 mb-2 flex items-center">
                        <span class="mr-2">üëï</span> What to Wear
                    </h3>
                    <ul class="text-sm text-blue-700 space-y-1 list-disc list-inside">
                        <li>Comfortable clothing (shorts/leggings and a t-shirt)</li>
                        <li>No zippers or buttons</li>
                        <li>Bare feet during classes</li>
                    </ul>
                </div>
                <div class="bg-white rounded-xl p-4 border border-blue-100">
                    <h3 class="font-bold text-blue-800 mb-2 flex items-center">
                        <span class="mr-2">üçΩÔ∏è</span> Food Guidelines
                    </h3>
                    <ul class="text-sm text-blue-700 space-y-1 list-disc list-inside">
                        <li>Avoid heavy meals 2-3 hours before class</li>
                        <li>No milk for minimum 1 hour before class</li>
                        <li>Minimal liquids 30 minutes before class</li>
                        <li>Bring a water bottle for hydration during class</li>
                    </ul>
                </div>
                <div class="bg-white rounded-xl p-4 border border-blue-100">
                    <h3 class="font-bold text-blue-800 mb-2 flex items-center">
                        <span class="mr-2">üìç</span> Find Us at Tumble Gym Mysore
                    </h3>
                    <p class="text-sm text-blue-700 mb-2">Need directions? Click below to navigate to our location:</p>
                    <a href="https://maps.google.com/?q=Tumble+Gym+Mysore" target="_blank" class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:shadow-lg transform hover:scale-105 transition-all">
                        <span>üó∫Ô∏è</span> Open in Google Maps
                    </a>
                </div>
            </div>
        </div>
    </div>

<div id="trainer" class="hidden pt-20 px-4 max-w-6xl mx-auto pb-20 min-h-screen">
        
        <header class="mb-8 flex justify-between items-end">
            <div>
                <h1 class="text-4xl font-extrabold section-header mb-2">Coach's Command Center üéØ</h1>
                <p id="trainer-welcome" class="text-slate-600 font-semibold">Ready to help our little gymnasts shine! ‚ú®</p>
            </div>
            <div class="text-right">
                <p id="current-date" class="font-bold text-blue-900"></p>
                <p class="text-xs text-slate-400 uppercase tracking-wide">Today</p>
            </div>
        </header>   
    
        <div class="flex space-x-2 mb-8 border-b border-slate-200 overflow-x-auto">
            <button onclick="window.switchTab('trials')" id="tab-btn-trials" class="tab-btn active-tab px-6 py-3 font-bold text-blue-600 border-b-2 border-blue-600">
                <i class="fas fa-clipboard-list mr-2"></i>Trial Requests
            </button>
            <button onclick="window.switchTab('inbox')" id="tab-btn-inbox" class="tab-btn px-6 py-3 font-bold text-slate-500 hover:text-blue-600 relative">
                <i class="fas fa-inbox mr-2"></i>Inbox
                <span id="inbox-badge" class="hidden absolute top-2 right-2 w-3 h-3 bg-red-500 rounded-full border-2 border-white"></span>
            </button>
            <button onclick="window.switchTab('batches')" id="tab-btn-batches" class="tab-btn px-6 py-3 font-bold text-slate-500 hover:text-blue-600">
                <i class="fas fa-users mr-2"></i>My Batches
            </button>
            <button onclick="window.switchTab('attendance')" id="tab-btn-attendance" class="tab-btn px-6 py-3 font-bold text-slate-500 hover:text-blue-600">
                <i class="fas fa-check-circle mr-2"></i>Attendance
            </button>
        </div>

        <div id="view-trials" class="tab-content">
            <!-- Search and Filter Bar (Admin Only) -->
            <div id="admin-search-bar" class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-6 hidden">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="admin-search-input" placeholder="Search by name, phone, email..." 
                            class="input-field w-full" onkeyup="window.handleAdminSearch()">
                    </div>
                    <button onclick="window.openAdminFilters()" class="bg-slate-100 text-slate-700 px-4 py-2 rounded-lg font-bold hover:bg-slate-200 transition flex items-center">
                        <i class="fas fa-filter mr-2"></i>Filters
                    </button>
                    <button onclick="window.openAdminEmailTemplates()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700 transition flex items-center">
                        <i class="fas fa-envelope mr-2"></i>Send Email
                    </button>
                    <button onclick="window.openAdminSettings()" class="bg-purple-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-purple-700 transition flex items-center">
                        <i class="fas fa-cog mr-2"></i>Settings
                    </button>
                </div>
                <div id="admin-active-filters" class="mt-3 flex flex-wrap gap-2 hidden"></div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-lg mb-4 text-blue-900 flex items-center">
                        <i class="fas fa-star text-yellow-400 mr-2"></i> New Requests
                    </h3>
                    <div id="list-new-trials" class="space-y-3">
                        <p class="text-sm text-slate-400 italic">Initializing System...</p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-lg mb-4 text-green-700 flex items-center">
                        <i class="fas fa-check-double mr-2"></i> Completed (Recent)
                    </h3>
                    <div id="list-completed-trials" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <div id="view-inbox" class="tab-content hidden">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden max-w-4xl mx-auto">
                <div class="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                    <h3 class="font-bold text-slate-700">All Conversations</h3>
                    <div class="flex items-center gap-3">
                        <div id="inbox-filters" class="flex gap-2"></div>
                        <button onclick="window.fetchAdminInbox ? window.fetchAdminInbox() : fetchInbox()" class="text-xs text-blue-600 hover:underline"><i class="fas fa-sync-alt"></i> Refresh</button>
                    </div>
                </div>
                <div id="list-inbox" class="divide-y divide-slate-100">
                    <div class="p-8 text-center text-slate-400">Loading messages...</div>
                </div>
            </div>
        </div>

        <div id="view-batches" class="tab-content hidden">
            <div class="bg-white p-8 rounded-2xl shadow text-center">
                <div class="w-16 h-16 bg-blue-100 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-layer-group text-2xl"></i></div>
                <h3 class="text-xl font-bold text-slate-800">Batch Management</h3>
                <p class="text-slate-500 mb-6">View student lists and batch timings.</p>
                <button class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold">Coming Soon</button>
            </div>
        </div>

        <div id="view-attendance" class="tab-content hidden">
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden max-w-4xl mx-auto">
                <div class="p-6 bg-gradient-to-r from-purple-600 to-indigo-600 text-white">
                    <h3 class="text-2xl font-bold mb-2 flex items-center">
                        <i class="fas fa-check-circle mr-3"></i>Daily Attendance
                    </h3>
                    <p class="text-purple-100 text-sm">Record attendance for active students</p>
                </div>
                
                <div class="p-6 space-y-6">
                    <!-- Date and Batch Selection -->
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Select Date *</label>
                            <input type="date" id="attendance-date" class="input-field w-full" value="">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Select Batch *</label>
                            <select id="attendance-batch" class="input-field w-full" onchange="window.loadAttendanceStudents()">
                                <option value="">Select Batch...</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="flex gap-3">
                        <button onclick="window.setAttendanceDate('today')" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold hover:bg-blue-200">
                            Today
                        </button>
                        <button onclick="window.setAttendanceDate('yesterday')" class="px-4 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm font-bold hover:bg-slate-200">
                            Yesterday
                        </button>
                        <button onclick="window.loadAttendanceStudents()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-bold hover:bg-green-700">
                            <i class="fas fa-sync-alt mr-2"></i>Load Students
                        </button>
                    </div>
                    
                    <!-- Attendance Summary -->
                    <div id="attendance-summary" class="hidden bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200">
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <p class="text-2xl font-bold text-green-700" id="summary-present">0</p>
                                <p class="text-xs text-green-600 font-bold">Present</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-red-700" id="summary-absent">0</p>
                                <p class="text-xs text-red-600 font-bold">Absent</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-slate-700" id="summary-total">0</p>
                                <p class="text-xs text-slate-600 font-bold">Total</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Students List -->
                    <div id="attendance-students-list" class="space-y-3">
                        <div class="text-center p-8 text-slate-400">
                            <i class="fas fa-info-circle text-2xl mb-2"></i>
                            <p>Select a date and batch to load students</p>
                        </div>
                    </div>
                    
                    <!-- Save Button -->
                    <div class="flex justify-end gap-3 pt-4 border-t">
                        <button onclick="window.saveAttendance()" id="btn-save-attendance" class="px-6 py-3 bg-purple-600 text-white rounded-lg font-bold hover:bg-purple-700 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-save mr-2"></i>Save Attendance
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div id="admin" class="hide pt-24 px-4 fade-in max-w-6xl mx-auto pb-20">
        <div class="flex justify-between items-end mb-8"><h1 class="text-3xl font-bold text-slate-800">Admin Dashboard</h1></div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="stat-card"><div class="stat-value" id="stat-total">0</div><div class="stat-label">Total Leads</div></div>
            <div class="stat-card"><div class="stat-value text-yellow-600" id="stat-reqs">0</div><div class="stat-label">Reg Requests</div></div>
        </div>
        <div class="bg-white p-6 rounded-2xl shadow"><div class="overflow-x-auto"><table class="w-full text-left text-sm"><tbody id="admin-list"></tbody></table></div></div>
    </div>

    <div id="login-modal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <h3 class="text-2xl font-extrabold text-slate-800 mb-2 flex items-center justify-center">
                <span class="mr-2">üëã</span> Welcome Back, Champion!
            </h3>
            <input type="email" id="login-email" class="input-field mb-3" placeholder="Email Address">
            <input type="password" id="login-password" class="input-field mb-4" placeholder="Password">
            <button type="button" id="btn-login-password" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg mb-3 hover:bg-blue-700 transition cursor-pointer">Login with Password</button>
            <button type="button" id="btn-login-magic" class="w-full bg-white text-slate-700 font-bold py-3 rounded-lg border hover:bg-slate-50 transition cursor-pointer">Email Login Link</button>
            <button type="button" onclick="document.getElementById('login-modal').classList.add('hidden')" class="text-slate-400 text-xs mt-6 underline hover:text-slate-600 cursor-pointer">Cancel</button>
        </div>
    </div>

    <div id="success-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="modal-content text-center p-8 bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-check text-2xl text-green-600"></i>
            </div>
            <h3 id="success-title" class="text-2xl font-bold text-slate-800 mb-2">üéâ Amazing! You Did It!</h3>
            <p id="success-msg" class="text-slate-600 text-sm mb-6">Action completed successfully.</p>
            <button onclick="document.getElementById('success-modal').classList.add('hidden'); window.location.reload();" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 rounded-lg hover:shadow-xl transform hover:scale-105 transition-all">
                üöÄ Awesome!
            </button>
        </div>
    </div>

    <div id="error-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm">
        <div class="modal-content text-center p-8 bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4 border-t-4 border-red-500">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-exclamation-triangle text-2xl text-red-600"></i>
            </div>
            
            <h3 id="error-title" class="text-2xl font-bold text-slate-800 mb-2">‚ö†Ô∏è Oops! Let's Fix This</h3>
            <p id="error-msg" class="text-slate-600 text-sm mb-6">Something went wrong.</p>
            
            <button onclick="document.getElementById('error-modal').classList.add('hidden')" class="w-full bg-gradient-to-r from-slate-700 to-slate-900 text-white font-bold py-3 rounded-lg hover:shadow-xl transform hover:scale-105 transition-all">
                üëç Got It, Let's Try Again!
            </button>
        </div>
    </div>

    <div id="trial-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-2 flex items-center">
                <span class="mr-2">üìù</span> Trial Session Assessment
            </h3>
            <p class="text-sm mb-4" id="modal-child-name"></p>
            <label>Feedback</label><textarea id="trainer-feedback" class="input-field mb-4" rows="4"></textarea>
            <label>Batch</label><select id="trainer-batch" class="input-field mb-6"><option value="3-5 Yrs">3-5 Yrs</option><option value="5-8 Yrs">5-8 Yrs</option><option value="8+ Yrs">8+ Yrs</option><option value="Adult">Adult</option></select>
            <button id="btn-save-trial" onclick="window.submitTrialResult()" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg">Save</button>
            <button onclick="document.getElementById('trial-modal').classList.add('hidden')" class="w-full text-slate-400 mt-2 text-xs">Close</button>
        </div>
    </div>

    <div id="reg-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-slate-900/80 flex items-center justify-center backdrop-blur-sm p-4 overflow-y-auto">
    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]">
        
        <div class="bg-slate-50 p-4 border-b border-slate-100 flex justify-between items-center sticky top-0 z-10">
            <div>
                <h2 class="text-2xl font-extrabold text-slate-800 mb-1">üéØ Complete Your Registration!</h2>
                <p class="text-xs text-slate-600 font-semibold">Let's get <span id="reg-child-name" class="text-blue-600 font-bold">your little star</span> (<span id="reg-child-age">0</span> Yrs) ready to shine! ‚ú®</p>
            </div>
            <button onclick="document.getElementById('reg-modal').classList.add('hidden')" class="w-8 h-8 rounded-full bg-white border border-slate-200 text-slate-400 hover:text-red-500 hover:border-red-200 transition flex items-center justify-center shadow-sm">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="p-6 overflow-y-auto space-y-6">
            <input type="hidden" id="is-renewal">
            <input type="hidden" id="default-batch-rec">
            <input type="hidden" id="calc-final-price">

            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-5 rounded-2xl border-2 border-blue-200 flex items-center justify-between shadow-md">
                <div class="flex-1">
                    <p class="text-xs text-blue-700 font-bold uppercase tracking-wide mb-1 flex items-center">
                        <span class="mr-1">‚≠ê</span> Perfect Program for Your Gymnast!
                    </p>
                    <h3 id="reg-program-display" class="text-xl font-extrabold text-blue-900">Loading...</h3>
                    <div id="trainer-badges" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
                <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-full flex items-center justify-center shadow-lg text-2xl shrink-0">
                    üèÜ
                </div>
            </div>

            <div>
                <h3 class="text-sm font-bold text-slate-800 uppercase tracking-wide mb-4"><i class="fas fa-sliders-h mr-2"></i> Customize Plan</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Time Preference</label>
                        <select id="reg-time-slot" onchange="window.updatePackageOptions(); window.checkApprovalRequirement();" class="input-field w-full bg-white">
                            <option value="Evening">Evening / Weekend</option>
                            <option value="Morning">Morning (Mixed Batch)</option>
                        </select>
                    </div>

                    <div id="group-batch-select">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Batch Category</label>
                        <select id="reg-batch-category" onchange="window.checkApprovalRequirement()" class="input-field w-full bg-white">
                            <option value="">Select Batch...</option>
                        </select>
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Select Package</label>
                        <select id="reg-package-select" onchange="window.calculateTotal(); window.updateSessionDaysSection()" class="input-field w-full bg-white border-2 border-slate-200 focus:border-blue-500 text-slate-800 font-bold">
                            <option value="" disabled selected>Select a Package...</option>
                            </select>
                    </div>
                    
                    <!-- Session Days Section (shown after package selection) -->
                    <div id="session-days-section" class="hidden md:col-span-2">
                        <!-- For unlimited packages: Show info -->
                        <div id="unlimited-session-info" class="hidden bg-gradient-to-br from-green-50 to-emerald-50 p-5 rounded-xl border-2 border-green-200 shadow-md">
                            <h3 class="text-sm font-bold text-green-900 uppercase tracking-wide mb-3 flex items-center">
                                <i class="fas fa-calendar-alt mr-2"></i> Your Available Session Days
                            </h3>
                            <div id="unlimited-session-details" class="text-xs text-green-800 space-y-2"></div>
                        </div>
                        
                        <!-- For limited packages: Ask to select 2 preferred days -->
                        <div id="limited-session-select" class="hidden bg-blue-50/50 p-6 rounded-2xl border border-blue-100/50">
                            <h3 class="text-sm font-bold text-slate-800 uppercase tracking-wide mb-3"><i class="fas fa-calendar-alt mr-2"></i> Preferred Session Days</h3>
                            <p class="text-xs text-slate-500 mb-2">Please select <strong>2 preferred days</strong> for planning purposes. (Classes not available Mondays)</p>
                            <p class="text-xs text-blue-600 mb-4 font-semibold">‚ÑπÔ∏è This is only for planning - you can attend on any available day based on your package.</p>
                            
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                <label class="flex items-center space-x-3 bg-white p-3 rounded-xl border border-blue-100 cursor-pointer hover:border-blue-400 hover:shadow-sm transition">
                                    <input type="checkbox" class="accent-blue-600 w-5 h-5 rounded session-day-checkbox" value="Tuesday" name="session_days" onchange="window.limitSessionDays()">
                                    <span class="text-sm text-slate-700 font-bold">Tuesday</span>
                                </label>
                                <label class="flex items-center space-x-3 bg-white p-3 rounded-xl border border-blue-100 cursor-pointer hover:border-blue-400 hover:shadow-sm transition">
                                    <input type="checkbox" class="accent-blue-600 w-5 h-5 rounded session-day-checkbox" value="Wednesday" name="session_days" onchange="window.limitSessionDays()">
                                    <span class="text-sm text-slate-700 font-bold">Wednesday</span>
                                </label>
                                <label class="flex items-center space-x-3 bg-white p-3 rounded-xl border border-blue-100 cursor-pointer hover:border-blue-400 hover:shadow-sm transition">
                                    <input type="checkbox" class="accent-blue-600 w-5 h-5 rounded session-day-checkbox" value="Thursday" name="session_days" onchange="window.limitSessionDays()">
                                    <span class="text-sm text-slate-700 font-bold">Thursday</span>
                                </label>
                                <label class="flex items-center space-x-3 bg-white p-3 rounded-xl border border-blue-100 cursor-pointer hover:border-blue-400 hover:shadow-sm transition">
                                    <input type="checkbox" class="accent-blue-600 w-5 h-5 rounded session-day-checkbox" value="Friday" name="session_days" onchange="window.limitSessionDays()">
                                    <span class="text-sm text-slate-700 font-bold">Friday</span>
                                </label>
                                <label class="flex items-center space-x-3 bg-white p-3 rounded-xl border border-blue-100 cursor-pointer hover:border-blue-400 hover:shadow-sm transition">
                                    <input type="checkbox" class="accent-blue-600 w-5 h-5 rounded session-day-checkbox" value="Saturday" name="session_days" onchange="window.limitSessionDays()">
                                    <span class="text-sm text-slate-700 font-bold">Saturday</span>
                                </label>
                                <label class="flex items-center space-x-3 bg-white p-3 rounded-xl border border-blue-100 cursor-pointer hover:border-blue-400 hover:shadow-sm transition">
                                    <input type="checkbox" class="accent-blue-600 w-5 h-5 rounded session-day-checkbox" value="Sunday" name="session_days" onchange="window.limitSessionDays()">
                                    <span class="text-sm text-slate-700 font-bold">Sunday</span>
                                </label>
                            </div>
                            <p id="session-days-error" class="text-xs text-red-600 mt-2 hidden font-bold">Please select exactly 2 preferred days.</p>
                        </div>
                    </div>

                    <!-- Kids PT Options (for non-adults) -->
                    <div id="group-pt-options-kids" class="hidden md:col-span-2 grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">PT Level</label>
                            <select id="reg-pt-level" onchange="window.calculateTotal()" class="input-field w-full bg-white">
                                <option value="Beginner">Beginner</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Advanced">Advanced</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">No. of Classes</label>
                            <input type="number" id="reg-pt-sessions" value="10" class="input-field w-full bg-white">
                        </div>
                    </div>
                    
                    <!-- Adult PT Options -->
                    <div id="group-pt-options" class="hidden md:col-span-2 space-y-4">
                        <div class="bg-gradient-to-br from-amber-50 to-yellow-50 p-5 rounded-xl border-2 border-amber-300 shadow-md">
                            <p class="text-sm text-amber-900 font-bold mb-2 flex items-center">
                                <span class="text-lg mr-2">üí¨</span> Let's Chat About Your Personal Training Plan!
                            </p>
                            <p class="text-xs text-amber-800 leading-relaxed">We'd love to discuss the perfect training schedule, session rates, and package options that work best for you. Our team will reach out to finalize all the details! üéØ</p>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Preferred Start Date *</label>
                            <input type="date" id="reg-pt-start-date" class="input-field w-full bg-white" min="">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Additional Notes (Optional)</label>
                            <textarea id="reg-pt-notes" rows="3" class="input-field w-full bg-white" placeholder="Any specific requirements or preferences..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Adult Morning Batch Info -->
                    <div id="adult-morning-info" class="hidden md:col-span-2 bg-gradient-to-br from-green-50 to-emerald-50 p-5 rounded-xl border-2 border-green-300 shadow-md">
                        <p class="text-sm text-green-900 font-bold mb-3 flex items-center">
                            <span class="text-lg mr-2">üåÖ</span> Morning Energy Boost - Consistent Fitness!
                        </p>
                        <ul class="text-xs text-green-800 space-y-2 list-none">
                            <li class="flex items-start"><span class="mr-2">‚è∞</span><span>Schedule: Tuesday to Friday, 6:15 AM - 7:15 AM only</span></li>
                        </ul>
                    </div>
                    
                    <!-- Kids Morning Batch Info -->
                    <div id="kids-morning-info" class="hidden md:col-span-2 bg-gradient-to-br from-green-50 to-emerald-50 p-5 rounded-xl border-2 border-green-300 shadow-md">
                        <p class="text-sm text-green-900 font-bold mb-3 flex items-center">
                            <span class="text-lg mr-2">üåÖ</span> Morning Energy Boost - Active Start!
                        </p>
                        <ul class="text-xs text-green-800 space-y-2 list-none">
                            <li class="flex items-start"><span class="mr-2">‚è∞</span><span>Schedule: Tuesday to Friday, 6:15 AM - 7:15 AM</span></li>
                            <li class="flex items-start"><span class="mr-2">üéâ</span><span>Bonus: Also available on weekends during your age group timings!</span></li>
                        </ul>
                    </div>
                    
                    <!-- Batch Change Reason Field (shown when parent changes batch) -->
                    <div id="batch-change-reason-section" class="hidden md:col-span-2">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Reason for Batch Change *</label>
                        <textarea id="batch-change-reason-text" rows="3" class="input-field w-full bg-white" placeholder="Please explain why you'd like to change the recommended batch..."></textarea>
                        <p class="text-xs text-amber-600 mt-1 font-semibold">This change requires admin approval before you can proceed with payment.</p>
                    </div>
                </div>
            </div>

            <!-- Start Date Field (moved above registration fee box) -->
            <div class="bg-slate-50 rounded-2xl p-6 border border-slate-100 mb-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Start Date *</label>
                    <input type="date" id="reg-date" class="input-field w-full bg-white" required>
                </div>
            </div>

            <div class="bg-slate-50 rounded-2xl p-6 border border-slate-100">
                
                <div id="approval-notice" class="hidden mb-6 p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3">
                    <i class="fas fa-info-circle text-amber-600 mt-0.5"></i>
                    <div class="text-xs text-amber-800 leading-relaxed" id="approval-notice-text">
                        <strong>Approval Required:</strong> You have customized the standard recommendation. Please submit a request; our Admin will review the changes and approve the final fee shortly.
                    </div>
                </div>

                <div id="fee-display-section">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-bold text-slate-500">Registration Fee</span>
                        <span class="text-sm font-bold text-slate-800">‚Çπ<span id="reg-fee-display">2000</span></span>
                    </div>
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-sm font-bold text-slate-500">Package Fee</span>
                        <span class="text-sm font-bold text-slate-800">
                            <span id="package-name-display" class="text-xs text-slate-600 mr-2">-</span>
                            ‚Çπ<span id="package-fee-display">0</span>
                        </span>
                    </div>
                    <div class="flex justify-between items-center mb-6 pt-4 border-t border-slate-200">
                        <span class="text-lg font-bold text-slate-800">Total Payable</span>
                        <span class="text-3xl font-black text-blue-600 tracking-tight">‚Çπ<span id="total-price">0</span></span>
                    </div>
                </div>

                <div id="payment-section" class="hidden space-y-4 transition-all duration-300">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Payment Mode *</label>
                        <select id="payment-mode" onchange="window.togglePaymentMode()" class="input-field w-full bg-white" required>
                            <option value="">Select Payment Mode...</option>
                            <option value="UPI">UPI (Online Payment)</option>
                            <option value="Cash">Cash (In-Person Payment)</option>
                        </select>
                    </div>
                    
                    <!-- UPI Payment Section -->
                    <div id="upi-payment-section" class="hidden space-y-4">
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-5 rounded-xl border-2 border-blue-200">
                            <p class="text-sm font-bold text-blue-900 mb-3 text-center">üí≥ Scan QR Code to Pay via UPI</p>
                            <div class="flex justify-center mb-3">
                                <img id="qr-code-image" src="" alt="UPI QR Code" class="w-48 h-48 border-2 border-blue-300 rounded-lg shadow-lg">
                            </div>
                            <p class="text-xs text-blue-700 text-center font-semibold">Scan with any UPI app (PhonePe, Google Pay, Paytm, etc.)</p>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Upload UPI Payment Confirmation *</label>
                            <input type="file" id="payment-proof" accept="image/*" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2.5 file:px-4 file:rounded-xl file:border-0 file:text-xs file:font-bold file:bg-white file:text-blue-600 file:border-blue-100 file:border hover:file:bg-blue-50 cursor-pointer" required>
                            <p class="text-xs text-slate-500 mt-1">Please upload a screenshot of your UPI payment confirmation</p>
                        </div>
                    </div>
                    
                    <!-- Cash Payment Section -->
                    <div id="cash-payment-section" class="hidden">
                        <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-5 rounded-xl border-2 border-green-200">
                            <p class="text-sm font-bold text-green-900 mb-2 text-center flex items-center justify-center">
                                <span class="mr-2">üí∞</span> Cash Payment
                            </p>
                            <p class="text-xs text-green-800 text-center">Please bring the exact amount on your first day of class. No screenshot upload needed.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex items-start gap-3 p-4 bg-yellow-50 rounded-xl border border-yellow-100">
                <input type="checkbox" id="reg-consent" class="mt-1 accent-blue-600 w-5 h-5 rounded cursor-pointer" required>
                <label for="reg-consent" class="text-xs text-slate-600 leading-relaxed cursor-pointer">
                    I acknowledge that participation carries inherent risks. I release Tumble Gym Mysore from liability. I agree to the <a href="#" class="text-blue-600 underline font-bold">Terms & Conditions</a>. *
                </label>
            </div>
        </div>

        <div class="bg-white p-4 border-t border-slate-100 flex gap-3 sticky bottom-0 z-10">
            <button onclick="document.getElementById('reg-modal').classList.add('hidden')" class="flex-1 py-3.5 rounded-xl text-slate-500 font-bold hover:bg-slate-50 transition">Cancel</button>
            
            <button id="btn-submit-pay" onclick="window.submitRegistration('PAY')" class="flex-1 bg-green-600 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-green-200 hover:bg-green-700 transition hidden">
                Pay & Enroll <i class="fas fa-check-circle ml-2"></i>
            </button>
            
            <button id="btn-submit-request" onclick="window.submitRegistration('REQUEST')" class="flex-1 bg-amber-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-amber-200 hover:bg-amber-600 transition hidden">
                Request Enrollment <i class="fas fa-paper-plane ml-2"></i>
            </button>
        </div>
    </div>
    </div>
    
    <div id="admin-modal" class="modal-overlay hidden">
        <div class="modal-content"><div id="admin-modal-body"></div><button onclick="document.getElementById('admin-modal').classList.add('hidden')" class="w-full text-slate-400 mt-4 text-xs">Close</button></div>
    </div>

    <div id="admin-package-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="bg-purple-600 p-4 text-white flex justify-between items-center shrink-0">
                <h3 class="font-bold text-lg"><i class="fas fa-cog mr-2"></i> Modify Package & Pricing</h3>
                <button onclick="document.getElementById('admin-package-modal').classList.add('hidden')" class="text-purple-100 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto">
                <input type="hidden" id="admin-pkg-lead-id">
                
                <div class="mb-6">
                    <h4 id="admin-pkg-child-name" class="text-xl font-bold text-slate-800 mb-2">Child Name</h4>
                    <p class="text-sm text-slate-500">Current Status: <span id="admin-pkg-status" class="font-bold"></span></p>
                </div>

                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 mb-6">
                    <h5 class="font-bold text-blue-900 mb-3 text-sm uppercase">Current Package Details</h5>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div><span class="text-slate-600">Batch:</span> <span id="admin-pkg-current-batch" class="font-bold text-slate-800">-</span></div>
                        <div><span class="text-slate-600">Package:</span> <span id="admin-pkg-current-package" class="font-bold text-slate-800">-</span></div>
                        <div id="admin-pkg-current-price-row"><span class="text-slate-600">Price:</span> <span id="admin-pkg-current-price" class="font-bold text-slate-800">-</span></div>
                        <div><span class="text-slate-600">Locked:</span> <span id="admin-pkg-current-locked" class="font-bold text-slate-800">-</span></div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Select Package Type</label>
                        <select id="admin-pkg-type" onchange="window.updateAdminPackageOptions()" class="input-field w-full">
                            <option value="">Select Package Type...</option>
                            <option value="standard">Standard Package (Evening/Weekend)</option>
                            <option value="morning">Morning Package (Unlimited)</option>
                            <option value="pt">Personal Training</option>
                            <option value="custom">Custom Package</option>
                        </select>
                    </div>

                    <div id="admin-pkg-standard-options" class="hidden">
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Standard Packages</label>
                        <select id="admin-pkg-standard-select" class="input-field w-full">
                            <option value="">Select Package...</option>
                        </select>
                    </div>

                    <div id="admin-pkg-morning-options" class="hidden">
                        <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Morning Package</label>
                        <select id="admin-pkg-morning-select" class="input-field w-full">
                            <option value="morn_child|5500|999|1">Morning Unlimited</option>
                        </select>
                        <p class="text-xs text-slate-500 mt-1">Same rate for all ages. Adults: Tue-Fri only. Kids: Tue-Fri + weekends during age group timings.</p>
                    </div>

                    <!-- PT Request Info (if adult PT request exists) -->
                    <div id="admin-pt-request-info" class="hidden bg-amber-50 p-4 rounded-xl border border-amber-200 mb-4">
                        <h5 class="font-bold text-amber-900 mb-2 text-sm"><i class="fas fa-info-circle mr-1"></i> Personal Training Request</h5>
                        <div id="admin-pt-request-details" class="text-xs text-amber-800 space-y-1"></div>
                    </div>
                    
                    <div id="admin-pkg-pt-options" class="hidden space-y-4">
                        <div id="admin-pkg-pt-rate-session-row" class="grid grid-cols-2 gap-4">
                            <div id="admin-pkg-pt-rate-container">
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Rate Per Session (‚Çπ)</label>
                                <input type="number" id="admin-pkg-pt-rate" min="0" placeholder="e.g., 700" class="input-field w-full">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Number of Sessions</label>
                                <input type="number" id="admin-pkg-pt-sessions" value="10" min="1" class="input-field w-full">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Validity Period</label>
                            <select id="admin-pkg-pt-validity-type" onchange="window.togglePTValidityInput()" class="input-field w-full mb-2">
                                <option value="month">1 Month</option>
                                <option value="quarter">3 Months (Quarter)</option>
                                <option value="halfyearly">6 Months (Half Yearly)</option>
                                <option value="yearly">12 Months (Yearly)</option>
                                <option value="specific">Specific Date</option>
                            </select>
                            <input type="date" id="admin-pkg-pt-validity-date" class="input-field w-full hidden" placeholder="Select end date">
                        </div>
                        
                        <div>
                            <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Start Date</label>
                            <input type="date" id="admin-pkg-pt-start-date" class="input-field w-full">
                        </div>
                    </div>

                    <div id="admin-pkg-custom-options" class="hidden space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Package Name</label>
                                <input type="text" id="admin-pkg-custom-name" placeholder="e.g., Custom 3 Months" class="input-field w-full">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Price (‚Çπ)</label>
                                <input type="number" id="admin-pkg-custom-price" min="0" class="input-field w-full">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Number of Classes</label>
                                <input type="number" id="admin-pkg-custom-classes" min="1" value="999" class="input-field w-full">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Duration (Months)</label>
                                <input type="number" id="admin-pkg-custom-months" min="1" value="1" class="input-field w-full">
                            </div>
                        </div>
                    </div>

                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200">
                        <div class="flex items-start gap-3">
                            <input type="checkbox" id="admin-pkg-lock" class="mt-1 accent-yellow-600 w-5 h-5 rounded cursor-pointer">
                            <div>
                                <label for="admin-pkg-lock" class="text-sm font-bold text-yellow-900 cursor-pointer">Lock Package</label>
                                <p class="text-xs text-yellow-700 mt-1">When locked, parent cannot modify this package. They must contact admin for changes.</p>
                            </div>
                        </div>
                        <div class="mt-3">
                            <label class="text-xs font-bold text-yellow-900">Lock Type:</label>
                            <select id="admin-pkg-lock-type" class="input-field w-full mt-1 text-sm">
                                <option value="one-time">One-Time (Until Changed Again)</option>
                                <option value="always">Always Locked (Requires Admin to Unlock)</option>
                            </select>
                        </div>
                    </div>

                    <div id="admin-custom-fee-section" class="bg-amber-50 p-4 rounded-xl border border-amber-200 mb-4">
                        <h5 class="font-bold text-amber-900 mb-3 text-sm uppercase">Custom Fee Override</h5>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Registration Fee (‚Çπ)</label>
                                <input type="number" id="admin-pkg-reg-fee-custom" min="0" value="2000" class="input-field w-full" onchange="window.calculateAdminPackageTotal()">
                                <label class="flex items-center gap-2 mt-2">
                                    <input type="checkbox" id="admin-pkg-reg-fee-override" class="accent-amber-600">
                                    <span class="text-xs text-amber-700">Override standard registration fee</span>
                                </label>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Package Fee Override (‚Çπ)</label>
                                <input type="number" id="admin-pkg-fee-override" min="0" class="input-field w-full" placeholder="Leave empty to use package price" onchange="window.calculateAdminPackageTotal()">
                                <label class="flex items-center gap-2 mt-2">
                                    <input type="checkbox" id="admin-pkg-fee-override-flag" class="accent-amber-600">
                                    <span class="text-xs text-amber-700">Override package fee (flagged for renewal)</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div id="admin-pkg-fee-display-section" class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-bold text-slate-700">Registration Fee</span>
                            <span class="text-sm font-bold text-slate-800">‚Çπ<span id="admin-pkg-reg-fee-display">2000</span></span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-bold text-slate-700">Package Fee</span>
                            <span class="text-sm font-bold text-slate-800">‚Çπ<span id="admin-pkg-fee-display">0</span></span>
                        </div>
                        <div class="flex justify-between items-center pt-3 border-t border-slate-300">
                            <span class="text-lg font-bold text-slate-800">Total Price</span>
                            <span class="text-2xl font-black text-purple-600">‚Çπ<span id="admin-pkg-total">0</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-4 border-t bg-slate-50 flex gap-3 shrink-0">
                <button onclick="document.getElementById('admin-package-modal').classList.add('hidden')" class="flex-1 py-3 rounded-xl text-slate-500 font-bold hover:bg-slate-100 transition">Cancel</button>
                <button onclick="window.saveAdminPackage()" class="flex-1 bg-purple-600 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-purple-700 transition">
                    <i class="fas fa-save mr-2"></i>Save Package
                </button>
            </div>
        </div>
    </div>

    <div id="assessment-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]">
            
            <div class="bg-blue-600 p-4 text-white flex justify-between items-center shrink-0">
                <h3 class="font-bold text-lg"><i class="fas fa-clipboard-check mr-2"></i> Trial Assessment</h3>
                <button onclick="document.getElementById('assessment-modal').classList.add('hidden')" class="text-blue-100 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="p-6 overflow-y-auto">
                <input type="hidden" id="assess-lead-id">
                
                <div class="text-center mb-6">
                    <h2 id="assess-child-name" class="text-2xl font-bold text-slate-800">Child Name</h2>
                    <div id="assess-child-info"></div>
                    <div id="assess-sibling-info"></div>
                    <p class="text-slate-500 text-sm">Trial Session Evaluation</p>
                </div>

                <div class="space-y-4 mb-6">
                    <label class="block text-sm font-bold text-slate-700 uppercase tracking-wide">Strengths Observed</label>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="border p-3 rounded-lg flex justify-between items-center">
                            <span class="text-sm font-medium">Listening</span>
                            <input type="checkbox" id="skill-listen" class="w-5 h-5 text-blue-600 rounded">
                        </div>
                        <div class="border p-3 rounded-lg flex justify-between items-center">
                            <span class="text-sm font-medium">Flexibility</span>
                            <input type="checkbox" id="skill-flex" class="w-5 h-5 text-blue-600 rounded">
                        </div>
                        <div class="border p-3 rounded-lg flex justify-between items-center">
                            <span class="text-sm font-medium">Strength</span>
                            <input type="checkbox" id="skill-strength" class="w-5 h-5 text-blue-600 rounded">
                        </div>
                        <div class="border p-3 rounded-lg flex justify-between items-center">
                            <span class="text-sm font-medium">Balance</span>
                            <input type="checkbox" id="skill-balance" class="w-5 h-5 text-blue-600 rounded">
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-bold text-slate-700 mb-2">Trainer Feedback</label>
                    <textarea id="assess-feedback" rows="3" class="w-full border border-slate-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="E.g., Great energy! Needs to work on focus."></textarea>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-bold text-slate-700 mb-2">Recommendation</label>
                    
                    <select id="assess-batch" class="w-full border border-slate-300 rounded-lg p-3 text-sm bg-white mb-3 font-medium text-slate-700">
                        <option value="Toddler (3-5 Yrs)">Toddler (3-5 Yrs)</option>
                        <option value="Beginner (5-8 Yrs)">Beginner (5-8 Yrs)</option>
                        <option value="Intermediate (8+ Yrs)">Intermediate (8+ Yrs)</option>
                        <option value="Adult Fitness">Adult Fitness</option>
                    </select>

                    <div class="flex items-center p-3 bg-purple-50 border border-purple-100 rounded-lg mb-2 transition hover:bg-purple-100 cursor-pointer" onclick="document.getElementById('assess-special').click()">
                        <input type="checkbox" id="assess-special" class="w-5 h-5 text-purple-600 rounded mr-3 pointer-events-none">
                        <label class="text-sm font-bold text-purple-800 cursor-pointer">Special Needs / Autism?</label>
                    </div>

                    <div class="flex items-center p-3 bg-blue-50 border border-blue-100 rounded-lg transition hover:bg-blue-100 cursor-pointer" onclick="document.getElementById('assess-pt').click()">
                        <input type="checkbox" id="assess-pt" class="w-5 h-5 text-blue-600 rounded mr-3 pointer-events-none">
                        <label class="text-sm font-bold text-blue-800 cursor-pointer">Recommend Personal Training?</label>
                    </div>
                </div>
            </div>

            <div class="p-4 border-t bg-slate-50 shrink-0">
                <button onclick="window.submitAssessment()" id="btn-save-assess" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-700 shadow-lg transition flex items-center justify-center">
                    <span>Complete Trial & Email Parent</span>
                    <i class="fas fa-paper-plane ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="chat-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md h-[600px] flex flex-col overflow-hidden">
            
            <div class="bg-slate-800 p-4 text-white flex justify-between items-center shrink-0">
                <div>
                    <h3 class="font-bold text-lg" id="chat-header-name">Parent Name</h3>
                    <p class="text-xs text-slate-400">Student: <span id="chat-student-name">...</span></p>
                </div>
                <button onclick="document.getElementById('chat-modal').classList.add('hidden')" class="text-slate-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div id="chat-history" class="flex-1 overflow-y-auto p-4 bg-slate-50 space-y-4">
                <div class="text-center text-xs text-slate-400 mt-4">Start of conversation</div>
            </div>

            <div class="p-3 bg-white border-t border-slate-200 shrink-0">
                <div class="flex items-center bg-slate-100 rounded-full px-4 py-2">
                    <input type="hidden" id="chat-lead-id">
                    <input type="text" id="chat-input" class="bg-transparent flex-1 outline-none text-sm" placeholder="Type a message to parent...">
                    <button onclick="window.sendChatMessage()" class="text-blue-600 hover:text-blue-700 ml-2">
                        <i class="fas fa-paper-plane text-lg"></i>
                    </button>
                </div>
                <p class="text-[10px] text-center text-slate-400 mt-2">
                    <i class="fas fa-lock text-[8px]"></i> Messages are logged for Admin review.
                </p>
            </div>
        </div>
    </div>

    <div id="feedback-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6">
            <div class="text-center mb-6">
                <div class="w-12 h-12 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-comment-alt text-lg"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800">Help Us Improve</h3>
                <p class="text-xs text-slate-500">We noticed you haven't registered yet. Is there a specific reason?</p>
            </div>

            <input type="hidden" id="feedback-lead-id">
            
            <label class="block text-xs font-bold text-slate-600 uppercase mb-2">Reason</label>
            <select id="feedback-reason" class="input-field mb-4 text-sm">
                <option value="" disabled selected>Select a reason...</option>
                <option value="Schedule Conflict">Schedule Conflict</option>
                <option value="Fees / Pricing">Fees / Pricing</option>
                <option value="Distance / Location">Distance / Location</option>
                <option value="Health Issues">Health Issues</option>
                <option value="Traveling / Out of Station">Traveling / Out of Station</option>
                <option value="Will Join Later">Will Join Later</option>
                <option value="Other">Other</option>
            </select>

            <label class="block text-xs font-bold text-slate-600 uppercase mb-2">Follow-up Date (Optional)</label>
            <input type="date" id="feedback-date" class="input-field mb-4 text-sm">

            <label class="block text-xs font-bold text-slate-600 uppercase mb-2">Comments</label>
            <textarea id="feedback-note" rows="2" class="input-field mb-6 text-sm" placeholder="Any additional details..."></textarea>

            <button onclick="window.submitParentFeedback()" class="w-full bg-slate-800 text-white font-bold py-3 rounded-lg hover:bg-slate-900 transition shadow-lg text-sm">Submit Feedback</button>
            <button onclick="document.getElementById('feedback-modal').classList.add('hidden')" class="w-full text-slate-400 mt-4 text-xs hover:text-slate-600">Cancel</button>
        </div>
    </div>

    <div id="edit-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="bg-slate-800 p-4 text-white flex justify-between items-center shrink-0">
                <h3 class="font-bold text-lg">Update Details</h3>
                <button onclick="document.getElementById('edit-modal').classList.add('hidden')" class="text-slate-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6 space-y-4 overflow-y-auto">
                <input type="hidden" id="edit-lead-id">
                <input type="hidden" id="edit-lead-str">
                
                <!-- View Assessment Details Button -->
                <div id="assessment-button-section" class="hidden">
                    <button onclick="window.viewAssessmentDetailsFromEdit()" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-2.5 rounded-xl shadow-md hover:shadow-lg transition flex items-center justify-center gap-2">
                        <i class="fas fa-clipboard-check"></i> View Assessment Details
                    </button>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Child Name</label>
                        <input type="text" id="read-child-name" class="input-field bg-slate-100 text-slate-500 cursor-not-allowed" readonly>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">DOB</label>
                        <input type="text" id="read-dob" class="input-field bg-slate-100 text-slate-500 cursor-not-allowed" readonly>
                    </div>
                </div>

                <!-- Photo Upload Section -->
                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Child Photo</label>
                    <div id="photo-upload-section" class="space-y-2">
                        <div id="current-photo-preview" class="hidden mb-2">
                            <p class="text-xs text-slate-600 mb-1">Current Photo:</p>
                            <img id="current-photo-img" src="" alt="Child Photo" class="w-24 h-24 object-cover rounded-lg border-2 border-slate-200">
                            <p class="text-xs text-amber-600 mt-1"><i class="fas fa-info-circle"></i> Photo can only be changed by admin</p>
                        </div>
                        <div id="photo-upload-input-section">
                            <input type="file" id="child-photo-upload" accept="image/jpeg,image/jpg,image/png,image/webp" class="hidden">
                            <label for="child-photo-upload" class="cursor-pointer inline-block bg-blue-50 border-2 border-blue-200 border-dashed rounded-lg p-4 text-center hover:bg-blue-100 transition">
                                <i class="fas fa-camera text-blue-600 text-xl mb-2"></i>
                                <p class="text-xs font-semibold text-blue-700">Click to upload photo</p>
                                <p class="text-xs text-blue-500 mt-1">One-time upload only ‚Ä¢ Max 1 MB</p>
                            </label>
                            <p id="photo-upload-filename" class="text-xs text-slate-600 mt-1 hidden"></p>
                            <p id="photo-upload-error" class="text-xs text-red-600 mt-1 hidden"></p>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Medical Info / Allergies</label>
                    <textarea id="update-medical" rows="2" class="input-field"></textarea>
                </div>
                
                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Emergency Contact</label>
                    <input type="tel" id="update-alt-phone" class="input-field">
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-1">Address</label>
                    <input type="text" id="update-address" class="input-field">
                </div>

                <!-- Package History Section -->
                <div>
                    <label class="block text-xs font-bold text-slate-700 uppercase mb-2">Package History</label>
                    <div id="package-history-container" class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                        <div class="text-center text-slate-400 text-sm py-4">
                            <i class="fas fa-spinner fa-spin"></i> Loading package history...
                        </div>
                    </div>
                </div>

                <button onclick="window.saveChildInfo()" id="btn-save-info" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 shadow-md transition mt-2">
                    Save Changes
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Handle photo file selection in edit modal
        document.addEventListener('DOMContentLoaded', function() {
            const photoUpload = document.getElementById('child-photo-upload');
            if (photoUpload) {
                photoUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    const filenameEl = document.getElementById('photo-upload-filename');
                    const errorEl = document.getElementById('photo-upload-error');
                    
                    // Clear previous errors
                    if (errorEl) {
                        errorEl.classList.add('hidden');
                        errorEl.textContent = '';
                    }
                    
                    if (file) {
                        // Validate file size (1 MB = 1048576 bytes)
                        const maxSize = 1 * 1024 * 1024; // 1 MB
                        if (file.size > maxSize) {
                            const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
                            if (errorEl) {
                                errorEl.textContent = `File size (${fileSizeMB} MB) exceeds 1 MB limit. Please compress the image.`;
                                errorEl.classList.remove('hidden');
                            }
                            // Clear the file input
                            e.target.value = '';
                            if (filenameEl) filenameEl.classList.add('hidden');
                            return;
                        }
                        
                        // Validate file type
                        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'];
                        if (!allowedTypes.includes(file.type)) {
                            if (errorEl) {
                                errorEl.textContent = 'Invalid file type. Please upload JPEG, PNG, or WebP image.';
                                errorEl.classList.remove('hidden');
                            }
                            // Clear the file input
                            e.target.value = '';
                            if (filenameEl) filenameEl.classList.add('hidden');
                            return;
                        }
                        
                        // Show filename if valid
                        if (filenameEl) {
                            const fileSizeKB = (file.size / 1024).toFixed(2);
                            filenameEl.textContent = `Selected: ${file.name} (${fileSizeKB} KB)`;
                            filenameEl.classList.remove('hidden');
                        }
                    } else {
                        if (filenameEl) filenameEl.classList.add('hidden');
                    }
                });
            }
        });
    </script>
    
    <!-- Student Profile Modal for Admin -->
    <div id="student-profile-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white flex justify-between items-center shrink-0">
                <h3 class="font-bold text-lg"><i class="fas fa-user-circle mr-2"></i> Student Profile</h3>
                <button onclick="document.getElementById('student-profile-modal').classList.add('hidden')" class="text-purple-100 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto" id="student-profile-content">
                <p class="text-center text-slate-400">Loading student information...</p>
            </div>
        </div>
    </div>

    <!-- Attendance Details Modal for Parents -->
    <div id="attendance-details-modal" class="modal-overlay hidden z-50 fixed inset-0 bg-black/50 flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 text-white flex justify-between items-center shrink-0">
                <h3 class="font-bold text-lg"><i class="fas fa-calendar-check mr-2"></i> Attendance Details</h3>
                <button onclick="document.getElementById('attendance-details-modal').classList.add('hidden')" class="text-blue-100 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="p-6 overflow-y-auto" id="attendance-details-content">
                <div class="text-center p-8 text-slate-400">
                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                    <p>Loading attendance records...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js?v=49"></script>
    <!-- Fallback: Ensure handleLogin is available even if module fails -->
    <script>
        // Fallback handler in case module doesn't load
        if (typeof window.handleLogin === 'undefined') {
            window.handleLogin = function() {
                console.error("handleLogin not loaded - module may have failed");
                alert("Login function not available. Please check console for errors and refresh the page.");
            };
        }
    </script>
</body>
</html>
